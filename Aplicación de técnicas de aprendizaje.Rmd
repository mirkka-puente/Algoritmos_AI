---
title: "Actividad 1: Aplicación de técnicas de aprendizaje no supervisado sobre datos biológicos"
author: "Mirkka Puente Madrid"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Actividad 1: Aplicación de técnicas de aprendizaje no supervisado sobre datos biológicos

## Preparación del entorno de trabajo (instalación y carga de paquetes adecuados)

### Analisis de componentes principales

```{r PCA}

#Remover todas las variables creadas en environment so far
rm(list=ls())
#Establecer nuestro directorio donde trabajaremos
setwd("C:/Users/User/Desktop/UNIR/Algoritmos_IA/Algoritmos_AI")

#Install libraries
# Instalación
pack_list <- c("ggplot2",
               "dplyr",
               "stats")

for (pack in pack_list) {
  if (!requireNamespace(pack, quietly = TRUE))
    install.packages(pack)
}

# Carga de librerias
library(stats)   # librería para el PCA
library(ggplot2) # librería para hacer la representación gráfica
library(dplyr)

#Save the data in our environment
file <- "data_1000.csv"
dt <- read.csv(file, fileEncoding="UTF-8-BOM", check.names=FALSE)
lb <- read.csv('labels.csv')
#Prueba
dt_500 <- read.csv("datos_500.csv", fileEncoding="UTF-8-BOM", check.names=FALSE)

# Guardado en un dataframe 
data_frame <- data.frame(sapply(dt_500[2:501], as.numeric))

# Estadisticos
summary(data_frame[, 1:10])

# Valores NA y 0
anyNA(data_frame)
na_counts <- colSums((is.na(data_frame)))

any(data_frame == 0)
zero_counts <- colSums(data_frame == 0)
zero_prop   <- zero_counts / nrow(data_frame)
#Determinar si la columna deberia eliminarse
for (i in seq_along(zero_prop)) {
  if (zero_prop[i] >= 0.9) {
    gen_zero[[count]] <- names(zero_prop)[i]
    count <- count + 1
  }
}

#Eliminar las columnas con un porcentaje de ceros mayor al 90%
dt_denoised <- data_frame %>% select(-any_of(unlist(gen_zero)))


# Podemos hacer un diagrama de cajas para variable y vemos los estadísticos y outliers
boxplot(dt_denoised[, 1:20], main = "Boxplot de los 20 primeros genes")

#Eliminar genes sin variabilidad, si el gen tiene varianza alta, se conserva
vars <- apply(dt_denoised, 2, var) #2 es para columnas, var calcula varianza
dt_high_var <- dt_denoised[, vars > quantile(vars, 0.1)] #calcula el percentil 10 de var

#Escalar datos
dt_scaled <- scale(dt_high_var)

#Remover variables que no vamos a usar
rm(dt_denoised, dt_high_var, gen_zero, count, i, zero_counts, zero_df, n)

# Funcion prcomp()
#   data: conjunto de datos
#   center: si queremos que las variables esten centradas en cero
#   scale: si queremos que las variables tengan varianza 1

# Calculo de componentes principales con la funcion prcomp
set.seed(1997)
pca.results <- prcomp(dt_scaled, center=FALSE, scale.=FALSE)

# Resultado de las componentes principales
pca.df <- data.frame(pca.results$x)

# Varianza (cuadrado de la desviacion tipica)
varianzas <- pca.results$sdev^2

# Total de la varianza de los datos
total.varianza <- sum(varianzas)

# Varianza explicada por cada componente principal
varianza.explicada <- varianzas/total.varianza

# Calculamos la varianza acumulada 
varianza.acumulada <- cumsum(varianza.explicada)

# Tomamos el numero de componentes principales que explican el 90% de la varianza
n.pc <- min(which(varianza.acumulada > 0.90))

# Etiquetas de los ejes del gráfico
x_label <- paste0(paste('PC1', round(varianza.explicada[1] * 100, 2)), '%')
y_label <- paste0(paste('PC2', round(varianza.explicada[2] * 100, 2)), '%')

# Representación gráfica de las primeras dos componentes principales respecto a los datos
ggplot(pca.df, aes(x=PC1, y=PC2, color=lb$Class)) +
  geom_point(size=3) +
  scale_color_manual(values=c('red', 'blue', 'green', 'orange', 'purple')) +
  labs(title='PCA - Types of Cancer', x=x_label, y=y_label, color='Grupo') +
  theme_classic() +
  theme(panel.grid.major = element_line(color="gray90"), panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = "gray95"), plot.title = element_text(hjust = 0.5))


```








